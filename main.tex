%% abtex2-modelo-projeto-pesquisa.tex, v-1 marcoswagner PFC 2 2023
%% Copyright 2020-2023 by abnTeX2 group at BCC-UFJ http://www.abntex.net.br/ 
%%
%% This work consists of the files abntex2-modelo-projeto-pesquisa.tex
%% and abntex2-modelo-references.bib
%%

% ---------------------------------------------------------------------
% ---------------------------------------------------------------------
% abnTeX2: Modelo Adaptado de Monografia em conformidade com 
% ABNT NBR 15287:2011 Informação e documentação - Monografia 
% --------------------------------------------------------------------- 
% ---------------------------------------------------------------------
\documentclass[
	12pt,				
	oneside,
	a4paper,		
    sumario=tradicional,
	english,			
	french,				
	spanish,			
	brazil,				
	documento
	]{abntex2}

% ---
% Configurações
% ---
\usepackage{abntex2/abntex2-bcc-ufj}
\renewcommand*\arraystretch{1.2} 
\usepackage{pdfpages} %para incluir pdf como páginas


% ---
% Pacotes básicos 
% ---
\usepackage{lmodern}					
\usepackage[T1]{fontenc}		
\usepackage[utf8]{inputenc}	
\usepackage{lastpage}		
\usepackage{indentfirst}	
\usepackage{color}			
\usepackage{graphicx}		
\usepackage{microtype} 		
% ---

% ---
% Pacotes adicionais,
% ---
\usepackage{lipsum}	
\usepackage{caption}
\usepackage{subcaption}
\usepackage{enumerate} 
\usepackage{listings}     
\usepackage{float}
\usepackage{roblang}

\usepackage{booktabs}
\usepackage{makecell}

\usepackage{xcolor}
\usepackage{tcolorbox}
\tcbuselibrary{listings}
\tcbuselibrary{skins}
\tcbuselibrary{breakable}
\definecolor{listbggray}{rgb}{0.95,0.95,0.95} % Fundo cinza claro para listings

\lstdefinelanguage{Bison}{
sensitive=true,
morekeywords={\%token,\%left,\%right,\%nonassoc,\%union,\%type,\%start,\%prec, |},
morecomment=[l]{//},
morecomment=[s]{/*}{*/},
morestring=[b]",
alsoletter={_\%} 
}

\lstdefinestyle{Bison}{
    language=Bison,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue}\bfseries,
    commentstyle=\color{gray}\itshape,
    stringstyle=\color{red},
    numbers=left,
    stepnumber=1,
    breaklines=true,
    showstringspaces=false,
    tabsize=4,
    emph={},
    literate={\$}{{\$}}1 {@}{{@}}1 {\{}{{\{}}1 {\}}{{\}}}1,
}

% --- 
% CONFIGURAÇÕES DE PACOTES
% --- 
\include{comandos}

% ---
% Informações de dados para CAPA e FOLHA DE ROSTO
% ---
\input{custom}
% ---

%% \includeonly{capitulos/1RefTeorico}

%%%%%%%%%=============== DOCUMENTO ===========%%%%%%%%%%%
% ----
% Início do documento
% ----
\begin{document}
\selectlanguage{brazil}
% Retira espaço extra obsoleto entre as frases.
\frenchspacing 

% ----------------------------------------------------------
% ELEMENTOS PRÉ-TEXTUAIS
% ----------------------------------------------------------
% \pretextual

% ---
% Capa
% ---
\imprimircapa
% ---

% ---
% Folha de rosto
% ---
\imprimirfolhaderosto
% ---


% ---
% Ficha Catalográfica
\begin{fichacatalografica}
    \includepdf{ficha}
\end{fichacatalografica}


% ---
% Inserir folha de aprovação
% ---
\includepdf{aprova}


% ---
% Dedicatória/Agradecimentos/Epígrafe
% ---
\include{agrad_dec_ep}

% ---
% RESUMOS
% ---
\include{resumos}

% ---

% ---
% inserir lista de ilustrações
% ---
\pdfbookmark[0]{\listfigurename}{lof}
\listoffigures*
\cleardoublepage
% ---

% ---
% inserir lista de tabelas
% ---
\pdfbookmark[0]{\listtablename}{lot}
\listoftables*
\cleardoublepage
% ---

% ---
% inserir lista de abreviaturas e siglas
% ---
\begin{siglas}

\item[AF] Autômato Finito
\item[ARM] Advanced RISC Machine
\item[AST] Árvore Sintática Abstrata
\item[AVR] Alf and Vegard’s RISC processor
\item[CFG] Context-Free Grammar
\item[CPU] Central Processing Unit
\item[IA] Inteligência Artificial
\item[IoT] Internet of Things
\item[IR] Intermediate Representation
\item[MCU] Microcontroller Unit
\item[ML] Machine Learning
\item[RAM] Random access memory
\item[RE] Regular Expression
\item[RL] Robotics Language
\item[TFLM] TensorFlow Lite Micro

\end{siglas}
% ---


% ---
% inserir o sumario
% ---
\pdfbookmark[0]{\contentsname}{toc}
\tableofcontents*
\cleardoublepage
% ---

% ===================================================
% ELEMENTOS TEXTUAIS - Capítulos ----
% ----------------------------------------------------------
\textual

\include{capitulos/0Introd}
\include{capitulos/1RefTeorico}
\include{capitulos/2TrabRelac}
\include{capitulos/4ImpConst}
\include{capitulos/5FuncDemo}
\include{capitulos/6AvalTest}
\include{capitulos/7ConcTrabFut}

% ----------------------------------------------------------
% ELEMENTOS PÓS-TEXTUAIS
% ----------------------------------------------------------
\postextual
% ----------------------------------------------------------

% ----------------------------------------------------------
% Referências bibliográficas
% ----------------------------------------------------------
\bibliography{bib}

% ----------------------------------------------------------
% Apêndices
% ----------------------------------------------------------


% ----------------------------------------------------------
% Anexos
% ----------------------------------------------------------

% ---
% Inicia os anexos
% ---
% ---
% Inicia os anexos
% ---
\begin{anexosenv}

% Imprime uma página indicando o início dos anexos
\partanexos

\chapter{Testes Unitários}\label{apendice:teste-sintaxe}

\begin{lstlisting}[style=rob, caption={Teste unitário com a biblioteca padrão \texttt{tflm.rob}}, label={lst:teste-bib-rob}]
use ai.tflm;

spam_model_data = {0x1c,0x0,0x0,0x0,0x54
// (Conteudo do modelo em bytes omitido para brevidade)
};

spam_model_data_size = 83304;

// Arena de memoria para tensores (16KB para garantir espaco suficiente)
tensor_arena = {0u:4096};

// Kernels necessarios para o modelo Spam, Gather, Mean, FullyConnected e Softmax
required_kernels = {36, 40, 9, 25};


int8 test_init() {
    h = InitializeInterpreter(spam_model_data, tensor_arena, required_kernels);
    if(h == 0){ 
        return 1;
    }
    DestroyInterpreter(h);
    return 0;
}

// Testa inferencia para frase nao SPAM
int8 test_infer_not_spam() {
    h = InitializeInterpreter(spam_model_data, tensor_arena, required_kernels);
    if(h == 0) {
        return 1;
    }

    in = GetInputTensor(h, 0);
    out = GetOutputTensor(h, 0);

    if(in == 0 or out == 0) {
        DestroyInterpreter(h);
        return 2;
    }
    // "This is a great article thank you for the information"
    dados = {1.0, 82.0, 70.0, 214.0, 55.0, 98.0, 84.0, 47.0, 89.0, 26.0, 73.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
    output = {0.0, 0.0};

    SetTensorArray(in, dados, 20);
    InvokeInterpreter(h);
    GetTensorArray(out, output, 2);
    DestroyInterpreter(h);

    PrintFloat(output[1]);

    if (output[1] > 0.1) {
        return 3;
    }
    return 0;
}

// Testa inferencia para frase SPAM
int8 test_infer_spam() {
    h = InitializeInterpreter(spam_model_data, tensor_arena, required_kernels);
    if(h == 0) {
        return 1;
    }

    in = GetInputTensor(h, 0);
    out = GetOutputTensor(h, 0);

    if(in == 0 or out == 0) {
        DestroyInterpreter(h);
        return 2;
    }
    // Frase: "win free money online click www site com"
    dados = {1.0, 93.0, 326.0, 72.0, 8.0, 485.0, 24.0, 35.0, 6.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0};
    output = {0.0, 0.0};

    SetTensorArray(in, dados, 20);
    InvokeInterpreter(h);
    GetTensorArray(out, output, 2);
    DestroyInterpreter(h);

    PrintFloat(output[1]);

    if(output[1] < 0.90) {
        return 3;
    }
    return 0;
}

// Testa falha ao obter tensor de entrada (indice invalido)
int8 test_input_tensor_fail() {
    h = InitializeInterpreter(spam_model_data, tensor_arena, required_kernels);
    if(h == 0) {
        return 1;
    }
    in = GetInputTensor(h, 99); // indice invalido
    DestroyInterpreter(h);
    if(in != 0) {
        return 2;
    }
    return 0;
}

// Testa falha ao obter tensor de saida (indice invalido)
int8 test_output_tensor_fail() {
    h = InitializeInterpreter(spam_model_data, tensor_arena, required_kernels);
    if(h == 0) {
        return 1;
    }
    out = GetOutputTensor(h, 99); // indice invalido
    DestroyInterpreter(h);
    if(out != 0) {
        return 2;
    }
    return 0;
}

// Executa todos os testes unitarios
int8 main() {
    result = 0;

    if(test_init() != 0){ result = 1;}
    if(test_infer_not_spam() != 0) {result = 2;}
    if(test_infer_spam() != 0) {result = 3;}
    if(test_input_tensor_fail() != 0) {result = 4;}
    if(test_output_tensor_fail() != 0) {result = 5;}

    PrintFloat(float(result));

    return result; // Todos passaram
}
\end{lstlisting}



\end{anexosenv}

%---------------------------------------------------------------------
% INDICE REMISSIVO
%---------------------------------------------------------------------
%\phantompart
\printindex
%---------------------------------------------------------------------

\end{document}
